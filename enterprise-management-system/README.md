# Enterprise Management System

Version: 1.0.0

Overview
--------

Enterprise Management System is a lightweight PHP web application designed to help small to medium teams manage projects, tasks, attendance and user administration. It provides role-based interfaces for Admins, Managers and Employees and includes common features such as authentication, project/task management, attendance check-ins, reporting, and uploads.

Target audience
---------------

- Small to medium businesses that need a simple, self-hosted project and employee management tool.
- Internal teams that prefer a lightweight PHP app that runs on XAMPP or a LAMP stack.

Technology stack
----------------

- PHP (7.4+ recommended)
- PDO (MySQL) for database access
- MySQL / MariaDB
- HTML/CSS/JS for frontend (no large frameworks)
- File-based uploads saved to `uploads/`

Repository structure
--------------------

- `index.php`, `login.php`, `logout.php`, `dashboard.php` — entry points and top-level pages
- `includes/` — shared utilities and configuration
  - `auth.php` — session and authentication helpers
  - `database.php` — PDO wrapper and connection
  - `security.php` — sanitization, escaping, CSRF and file validation helpers
  - `config.php` — app config and constants (BASE_URL, DB settings, session timeout)
- `modules/` — role-specific modules
  - `admin/` — admin dashboard, users, reports
  - `manager/` — manager dashboard, projects, teams
  - `employee/` — employee dashboard, profile, tasks, submit report
- `css/` and `js/` — styles and client scripts
- `sql/database.sql` — database schema and seed (import this to create tables)
- `uploads/` — uploaded images and reports

Core features
-------------

Authentication & Authorization
- Login with username/password
- Role-based routing and guards (Admin, Manager, Employee)
- Session timeout and session regeneration on login

User management (Admin)
- Create, edit and manage users
- Role assignment and activation/deactivation

Project & Team (Manager)
- Create and manage projects
- Assign teams to projects
- View project progress, tasks stats

Task management (Manager, Employee)
- Create tasks, assign to employees
- Task priorities, due dates, status updates
- Employees can update status, add progress notes and comments

Profile & Attendance (Employee)
- Update personal information and avatar
- Check-in / mark attendance (simple mechanism)
- View tasks, stats, and recent activity

Reporting
- Managers and Admins can view reports (basic UI)
- Employees can submit reports (saved to `uploads/reports/` by default)

Uploads
- Profile images and attachments are uploaded to `uploads/`.

Security measures (explanation and how they're implemented)
---------------------------------

This section explains the security-focused design and where it appears in the codebase.

1) SQL Injection Prevention
- Use of prepared statements with PDO across the codebase (see `includes/database.php` and usages in modules). Example style used throughout:

  $stmt = $db->prepare("SELECT * FROM users WHERE username = ?");
  $stmt->execute([$username]);

- PDO option set: ATTR_EMULATE_PREPARES = false. This ensures that PDO uses native prepared statements where possible and avoids emulation which can reintroduce injection risks.

2) Input sanitization and output escaping
- `Security::sanitizeInput()` is used to sanitize and normalize incoming input. It strips tags and uses `htmlspecialchars` for strings where appropriate.
- `Security::escapeOutput()` is used when printing data into HTML to prevent XSS attacks.

3) CSRF protection
- All sensitive state-changing forms include a CSRF token generated by `Security::generateCSRFToken()` and validated with `Security::validateCSRFToken()` on POST handlers.
- Logout flow was updated to require POST and a valid token (prevents CSRF logout links).

4) Session management
- Sessions are started in `includes/auth.php` and the app regenerates session IDs on successful login (session_regenerate_id(true)).
- Session timeout is enforced via `SESSION_TIMEOUT` in `includes/config.php`. When a session is expired the user is logged out.

5) File upload validation
- `Security::validateFile()` checks upload errors, file size (MAX_FILE_SIZE), MIME type using `finfo` and scans for suspicious content (PHP tags, script tags, dangerous patterns). Files are stored in `uploads/` and unique filenames are generated.

6) Rate limiting for login attempts
- A simple login attempt recording mechanism exists via `Security::recordLoginAttempt()` and `Security::checkLoginAttempts()` (session-backed). This reduces brute-force risk. This is minimal and may be replaced with a DB-backed solution for multi-server deployments.

7) Other hardening notes
- Passwords are hashed using PHP's `password_hash()` and verified with `password_verify()`.
- Where redirects or headers are used, the app calls `exit()` after header to avoid further output.

Database schema (high-level)
---------------------------

The `sql/database.sql` file contains the detailed schema. Key tables include:

- `users` — columns: id, username, password (hash), full_name, email, role (admin/manager/employee), profile_image, status, created_at, last_login, etc.
- `projects` — id, name, description, manager_id, status, start_date, end_date, created_at
- `tasks` — id, title, description, project_id, assigned_by, assigned_to, priority, status, due_date, created_at, completed_at
- `attendance` — id, user_id, date, check_in, check_out

Note: some code historically referred to columns like `updated_at` on tasks; ensure your schema matches queries or adapt queries. The shipped code uses `created_at` and `completed_at`.

How the system works — request flow
----------------------------------

1) Public entry
- `index.php` or `login.php` presents the login form.

2) Authentication
- On login, credentials are verified using prepared statements against the `users` table. On success, session variables are set and session ID is regenerated.

3) Authorization and routing
- `includes/header.php` and individual module pages call `Auth::checkSession()` and `Auth::hasRole()` to ensure only authorized users can access role-specific pages.

4) CRUD operations
- Manager/Admin/Employee pages perform CRUD via PDO prepared statements; forms include CSRF tokens for state-changing operations.

5) File uploads and reports
- Profile images are uploaded and validated, then filename saved to `users.profile_image`.
- Employee reports are saved to `uploads/reports/` by default (can be migrated to a DB table).

Deployment and setup (Windows / XAMPP)
------------------------------------

1) Requirements
- XAMPP with Apache + PHP (7.4+), MySQL/MariaDB
- Ensure `php` CLI is on PATH if you want to run `php -l` locally

2) Steps
- Place the project in `C:\xampp\htdocs\enterprise-management-system` (or any other htdocs subfolder).
- Edit `includes/config.php` to set DB credentials and `BASE_URL` (for example `http://localhost/enterprise-management-system/`).
- Create the database and import the schema file:

  - Open phpMyAdmin or MySQL console and create a database (e.g., `enterprise_system`).
  - Import `sql/database.sql` into the created database.

- Update `DB_HOST`, `DB_NAME`, `DB_USER`, `DB_PASS` in `includes/config.php`.
- Ensure `uploads/` is writable by the webserver (on Windows with XAMPP this typically works out-of-the-box in `htdocs`).
- Open the app in your browser at `http://localhost/enterprise-management-system/` and create test users (or use provided seeds if present in SQL).

Testing & quick checks
----------------------

- Syntax check (if PHP CLI is available):

```powershell
php -l includes/header.php
php -l modules/employee/profile.php
```

- Try the login flow and exercise each role (admin, manager, employee).
- Check file uploads and confirm `uploads/` populates.

Extending the app
-----------------

- Replace session-backed login attempt records with a DB-backed rate limiter for multi-server setups.
- Store employee reports in a `reports` DB table and add manager review UI.
- Add stronger role permissions for granular actions, e.g., per-project permissions.
- Move inline CSS blocks into central CSS files for maintainability.

Troubleshooting
---------------

- Fatal errors complaining about missing DB columns: open `sql/database.sql` and ensure schema matches code queries (or update queries to use columns that exist). Example: if `updated_at` is referenced but not present, either add the column or change queries to use `created_at`/`completed_at`.
- If logout or navigation links produce 404s from module pages, confirm `BASE_URL` is set in `includes/config.php`. Broken relative links are the most common cause.
- If uploads fail, ensure `uploads/` folder permissions allow writing and check `MAX_FILE_SIZE` in `includes/config.php`.

Security checklist before production
-----------------------------------

- Disable display_errors and set error reporting to log only in `includes/config.php`.
- Use HTTPS and configure Apache to redirect HTTP to HTTPS.
- Use strong DB credentials and limit DB user privileges.
- Consider additional protections: Content Security Policy, SameSite cookies, HTTP security headers.
- Consider adding two-factor authentication for admin accounts.

Acknowledgements & contact
--------------------------

This application was designed as a small internal management tool. If you'd like improvements (DB-backed reports, role-based ACLs, or unit tests), open an issue or request changes.

---

File: README.md — generated automatically to document the codebase, features and security design.

Common SQL queries & ER diagram
--------------------------------

Here are a few useful queries you might run against the database and a simple ASCII ER diagram showing key relationships.

Example queries

- Get all tasks assigned to a user (with project name):

```sql
SELECT t.*, p.name as project_name
FROM tasks t
JOIN projects p ON t.project_id = p.id
WHERE t.assigned_to = :user_id
ORDER BY t.due_date ASC;
```

- Get overdue tasks for a manager's projects:

```sql
SELECT t.*
FROM tasks t
JOIN projects p ON t.project_id = p.id
WHERE p.manager_id = :manager_id
  AND t.due_date < CURDATE()
  AND t.status <> 'completed';
```

- Summary: tasks completed per month for a user (last 6 months):

```sql
SELECT DATE_FORMAT(created_at, '%Y-%m') as month,
       COUNT(*) as tasks_assigned,
       SUM(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as tasks_completed
FROM tasks
WHERE assigned_to = :user_id
  AND created_at >= DATE_SUB(NOW(), INTERVAL 6 MONTH)
GROUP BY DATE_FORMAT(created_at, '%Y-%m')
ORDER BY month;
```

- Get reports submitted by employees (recent first):

```sql
SELECT r.*, u.full_name, u.email
FROM reports r
JOIN users u ON r.user_id = u.id
ORDER BY r.created_at DESC
LIMIT 100;
```

Simple ASCII ER diagram

```
[users] 1---* [projects]  (users.id => projects.manager_id)
   |                |
   |                *
   *                [tasks] (projects.id => tasks.project_id)
   |               / | \
   |              /  |  \
 [attendance]   /   |   [reports]
                /    |
      (tasks.assigned_to -> users.id)

Key:
- users.id is referenced by projects.manager_id, tasks.assigned_to, tasks.assigned_by, attendance.user_id, reports.user_id
```

